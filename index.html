<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="ã‚†ãšPOS">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<meta charset="UTF-8">
<title>ã€POSã€‘ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒ»ãƒãƒ«ãƒ»ã‚†ãšã€‚</title>
<style>
  body { font-family: monospace; margin:0; padding:10px; }
  .container { display: grid; grid-template-columns: 30% 70%; gap: 15px; height: 100vh; box-sizing: border-box; }
  .left { border-right: 2px solid #ccc; padding: 10px; overflow-y: auto; }
  #cart { margin: 10px 0; border: 1px solid #000; padding: 6px; }
  #cart ul { padding-left: 18px; }
  button.small { font-size: 12px; margin-left: 4px; }
  .payment-method button { margin: 5px; padding: 10px 20px; font-size: 16px; border-radius: 8px; }
  .payment-method button.active { background: #007bff; color: #fff; }
  .calc { display: grid; grid-template-columns: repeat(3, 90px); gap: 10px; margin: 20px 0; justify-content: center; }
  .calc button { padding: 20px; font-size: 24px; border-radius: 16px; border: none; background-color: #f0f0f0; cursor: pointer; box-shadow: 0 3px 6px rgba(0,0,0,0.2); transition: 0.2s; }
  .calc button:hover { background-color: #e0e0e0; transform: translateY(-2px); }
  #amountInput { font-size:20px; width:210px; text-align:right; padding:5px; }
  .right { padding: 10px; overflow-y: auto; }
  .menu { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
  .menu button { aspect-ratio: 8 / 5; width: 80%; font-size: 18px; border-radius: 15px; }
  #receipt { display: none; font-family: monospace; width: 58mm; font-size: 10pt; line-height: 1.1; padding: 2mm; }
  #receipt hr { border: none; border-top: 1px solid #000; margin: 2px 0; }
  @media print {
        #receipt { display: block !important; width: 58mm; font-size: 10pt; line-height: 1.1; page-break-inside: avoid; }
        #receipt hr { border: none; border-top: 1px solid #000; margin: 2px 0; }
    }
  .action-btn { padding: 10px 20px; font-size: 16px; border-radius: 8px; margin: 5px 5px 5px 0; border: none; color: #fff; cursor: pointer; transition: 0.2s; }
  /* å€‹åˆ¥ã‚«ãƒ©ãƒ¼ */
  .action-btn.confirm { background-color: #28a745; }
  .action-btn.print   { background-color: #007bff; } 
  .action-btn.export  { background-color: #ccc; }
  .action-btn.reset   { background-color: #ccc; } 
  /* ãƒ›ãƒãƒ¼åŠ¹æœ */
  .action-btn:hover { opacity: 0.85; }
  /* ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ */
  .popup-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.4); justify-content: center; align-items: center; z-index: 1000; }
  /* ãƒ¢ãƒ¼ãƒ€ãƒ«æœ¬ä½“ */
  .popup-content { background-color: #fff; padding: 30px 40px; border-radius: 16px; text-align: center; box-shadow: 0 6px 12px rgba(0,0,0,0.3); min-width: 260px; max-width: 90%; font-size: 20px; }
  /* OKãƒœã‚¿ãƒ³ */
  .popup-content button { margin-top: 25px; padding: 16px 32px; border-radius: 12px; border: none; background-color: #0d76ff; color: #fff; font-size: 18px; cursor: pointer; }
  .popup-content button:hover { background-color: #095acc; }

  #paymentModal .modal-buttons { display: flex; justify-content: space-between; gap: 10px; margin-top: 15px; }

  #paymentModal button { flex: 1; font-size: 22px; padding: 12px 0; border: none; border-radius: 8px; cursor: pointer; transition: 0.2s; }

  .btn-confirm { background-color: #4CAF50; color: #fff; }
  .btn-confirm:hover { background-color: #45a049; }

  .btn-cancel { background-color: #f44336; color: #fff; }
  .btn-cancel:hover { background-color: #d32f2f; }

  #paymentModal button:last-of-type { background-color: #f44336; color: #fff; }
  #paymentModal button:last-of-type:hover { background-color: #d32f2f; }
  #productMasterList { list-style: none; padding: 0; margin: 0; }
  .product-item { display: flex; justify-content: space-between; align-items: center; margin: 5px 0; padding: 5px; border-bottom: 1px solid #ddd; }
  .btn-box { display: flex; flex-direction: column; gap: 4px; align-items: flex-end; }
  .btn-box button { background: none; border: none; font-size: 18px; cursor: pointer; line-height: 1; }
  .btn-box button:hover { opacity: 0.7; }
  .toggle-btn { background: none; border: none; cursor: pointer; font-size: 14px; margin-left: 8px; }
  .section-content { margin: 5px 0 15px 0; }
</style>
</head>
<body>


<div class="container">
  <div class="left">
    <h2 style="display: flex; align-items: center; gap: 10px;">
        <img src="diningbar_yuzu_OL2.PNG" alt="ãƒ­ã‚´" style="height:100px;">
        ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒ»ãƒãƒ«ãƒ»ã‚†ãšã€‚
    </h2>
    
    <div id="cart">
      <h3>ã‚«ãƒ¼ãƒˆå†…å®¹</h3>
      <ul id="cartList"></ul>
      <p>åˆè¨ˆ: <span id="total">0</span> å††</p>
    </div>

    <div class="payment-method">
      <h3>æ”¯æ‰•æ–¹æ³•</h3>
      <button onclick="setPayment('ç¾é‡‘')">ç¾é‡‘</button>
      <button onclick="setPayment('ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ')">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ</button>
      <button onclick="setPayment('PayPay')">PayPay</button>
    </div>

    <div id="paymentModal" style="display:none; position:fixed;font-size: 20px; top:0; left:0; width:100%; height:100%; 
            background: rgba(0,0,0,0.5); justify-content:center; align-items:center;">
        <div style="background:#fff; padding:20px; border-radius:10px; width:300px; text-align:center;">
            <h3>é ã‚Šé‡‘å…¥åŠ›</h3>
            <input type="text" id="modalAmountInput" readonly style="font-size:20px; width:100%; text-align:right;">
            <div class="calc" id="modalCalcPad"></div>
            <p>ãŠã¤ã‚Š: <span id="modalChange">0</span> å††</p>

            <!-- ãƒœã‚¿ãƒ³ã‚’ãƒ©ãƒƒãƒ— -->
            <div class="modal-buttons">
                <button class="btn-confirm" onclick="confirmPayment()">ç¢ºå®š</button>
                <button class="btn-cancel" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>

        </div>
    </div>

    
    <button class="action-btn confirm" onclick="confirmOrder()">ä¼šè¨ˆç¢ºå®š</button>
    <button class="action-btn print" onclick="printKitchen()">ã‚­ãƒƒãƒãƒ³ä¼ç¥¨å°åˆ·</button>
    
    <hr>
      <h3>
        å£²ä¸Šé›†è¨ˆ 
        <button class="toggle-btn" onclick="toggleSection('salesSummary', this)">â–¼</button>
      </h3>
      <div id="salesSummary" class="section-content">
        <ul id="salesList"></ul>
        <p>ç´¯è¨ˆå£²ä¸Š: <span id="salesTotal">0</span> å††</p>
      </div>
    <hr>
    <h3>
      å•†å“åˆ¥å£²ä¸Š 
      <button class="toggle-btn" onclick="toggleSection('itemSummary', this)">â–¼</button>
    </h3>
    <div id="itemSummary" class="section-content">
      <ul id="productSummary"></ul>
    </div>
    <h3>
      æ±ºæ¸ˆæ–¹æ³•åˆ¥å£²ä¸Š 
      <button class="toggle-btn" onclick="toggleSection('paymentSummary', this)">â–¼</button>
    </h3>
    <div id="paymentSummary" class="section-content">
      <ul id="paymentSummary"></ul>
    </div>
    <button class="action-btn export" onclick="exportCSV()">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
    <button class="action-btn reset" onclick="resetSales()">å£²ä¸Šå±¥æ­´ãƒªã‚»ãƒƒãƒˆ</button>

    <hr>
    <h3>
      å•†å“ãƒã‚¹ã‚¿ç®¡ç† 
      <button class="toggle-btn" onclick="toggleSection('productMaster', this)">â–¼</button>
    </h3>
    <div id="productMaster" class="section-content">      <input type="text" id="newProductName" placeholder="å•†å“å" style="width:120px;">
      <input type="number" id="newProductPrice" placeholder="å˜ä¾¡" style="width:80px;">
      <button onclick="addProduct()">è¿½åŠ </button>
      <ul id="productMasterList"></ul>
    </div>

  </div>
    
  <div class="right">
    <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
    <div class="menu" id="menu"></div>
  </div>
</div>

<!-- ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="popupModal" class="popup-modal">
  <div class="popup-content">
    <p id="popupMessage"></p>
    <button onclick="closePopup()">OK</button>
  </div>
</div>

<div id="receipt"></div>

<script>
const products = [
  { name: "ã–ã‚“ã", price: 700 }, { name: "ãƒŸãƒ‹ã‚«ãƒƒãƒ—", price: 350 },
  { name: "ãƒ•ãƒ©ãƒ³ã‚¯ãƒ•ãƒ«ãƒˆ", price: 400 }, { name: "ãã‚…ã†ã‚Š", price: 300 },
  { name: "ã‹ãæ°·", price: 400 }, { name: "ãƒ•ãƒ«ãƒ¼ãƒ„ãƒãƒ³ãƒ", price: 600 },
  { name: "ã‚¢ãƒã‚´", price: 600 }, { name: "ç”Ÿãƒ“ãƒ¼ãƒ«", price: 700 },
  { name: "ãƒ¬ãƒ¢ãƒ³ã‚µãƒ¯ãƒ¼", price: 600 }, { name: "ãƒã‚¤ãƒœãƒ¼ãƒ«", price: 600 },
  { name: "ç„¼é…(æ°´ãƒ»ã‚½ãƒ¼ãƒ€)", price: 600 }, { name: "æ¢…å¹²ã—", price: 100 },
  { name: "ãƒãƒ³ã‚¢ãƒ«", price: 500 }, { name: "ã‚³ãƒ¼ãƒ©", price: 300 },
  { name: "ãƒªãƒ³ã‚´", price: 300 }, { name: "ã‚«ãƒ«ãƒ”ã‚¹", price: 300 },
  { name: "ICEã‚³ãƒ¼ãƒ’ãƒ¼", price: 400 }, { name: "ãƒ¬ãƒ¢ãƒãƒ¼ãƒ‰(æ°´ãƒ»ã‚½ãƒ¼ãƒ€)", price: 400 },
  { name: "ã‚ªãƒ¬ãƒ³ã‚¸", price: 600 }, { name: "ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„", price: 600 },
  { name: "ã‚ªãƒ¬ãƒ³ã‚¸ã‚¹ã‚«ãƒƒã‚·ãƒ¥", price: 700 }, { name: "ã‚°ãƒ¬ãƒ•ãƒ«ã‚¹ã‚«ãƒƒã‚·ãƒ¥", price: 700 },
  { name: "ãƒ¬ãƒ¢ãƒ³ã‚¹ã‚«ãƒƒã‚·ãƒ¥", price: 700 }
];

let cart = [];
let sales = [];
let paymentMethod = "ç¾é‡‘";

if(localStorage.getItem("sales")){
  sales = JSON.parse(localStorage.getItem("sales"));
  renderSales();
}

document.addEventListener("DOMContentLoaded", () => {
  setPayment("ç¾é‡‘");
});

const menuDiv = document.getElementById("menu");
products.forEach((p) => {
  let btn = document.createElement("button");
  btn.textContent = `${p.name}\n${p.price}å††`;
  btn.onclick = () => addToCart(p);
  menuDiv.appendChild(btn);
});

function addToCart(p) {
  let found = cart.find(i => i.name === p.name);
  if(found){ found.qty++; } 
  else { cart.push({ ...p, qty: 1 }); }
  renderCart();
}

function renderCart() {
  const list = document.getElementById("cartList");
  list.innerHTML = "";
  let total = 0;
  cart.forEach((item, i) => {
    let li = document.createElement("li");
    li.textContent = `${item.name} - ${item.price}å†† x${item.qty}`;
    total += item.price * item.qty;
    let plusBtn = document.createElement("button");
    plusBtn.textContent = "ï¼‹"; plusBtn.className="small";
    plusBtn.onclick = ()=>{ item.qty++; renderCart(); };
    let minusBtn = document.createElement("button");
    minusBtn.textContent = "ï¼"; minusBtn.className="small";
    minusBtn.onclick = ()=>{ item.qty--; if(item.qty<=0) cart.splice(i,1); renderCart(); };
    let delBtn = document.createElement("button");
    delBtn.textContent="ğŸ—‘ï¸"; delBtn.className="small";
    delBtn.onclick=()=>{ cart.splice(i,1); renderCart(); };
    li.appendChild(plusBtn); li.appendChild(minusBtn); li.appendChild(delBtn);
    list.appendChild(li);
  });
  document.getElementById("total").textContent = total;
}

function setPayment(method){
  paymentMethod = method;
  document.querySelectorAll(".payment-method button").forEach(btn=>{
    btn.classList.remove("active");
    if(btn.textContent===method) btn.classList.add("active");
  });
}

function confirmOrder() {
  if(cart.length === 0) return showPopup("ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™ã€‚");
  if(!paymentMethod) return showPopup("æ”¯æ‰•æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
  openModal();
}

function openModal() {
  const input = document.getElementById("modalAmountInput");
  document.getElementById("paymentModal").style.display = "flex";

  const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
  input.value = total;

  input.dataset.isEdited = "false"; // åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
  updateModalChange();
}


function closeModal(){
  document.getElementById("paymentModal").style.display="none";
}

const modalCalcPad = document.getElementById("modalCalcPad");

["7","8","9","4","5","6","1","2","3","0","00","C"].forEach(v=>{
  let b = document.createElement("button");
  b.textContent=v;
  b.onclick=()=>{
    let input = document.getElementById("modalAmountInput");

    // åˆæœŸå€¤ãƒ•ãƒ©ã‚°åˆ¤å®š
    if (input.dataset.isEdited !== "true") {
      input.value = ""; 
      input.dataset.isEdited = "true";
    }

    if (v === "C") {
      input.value = "";
    } else {
      // å…¥åŠ›å€™è£œ
      let newVal = input.value + v;

      // å…ˆé ­ã‚¼ãƒ­ç¦æ­¢
      if (newVal.length > 1 && newVal[0] === "0") {
        newVal = newVal.replace(/^0+/, ""); 
      }

      // æ¡æ•°åˆ¶é™ï¼ˆ6æ¡ã¾ã§ï¼‰
      if (newVal.length > 6) {
        return; // ã“ã‚Œä»¥ä¸Šè¿½åŠ ã—ãªã„
      }

      input.value = newVal;
    }

    updateModalChange();
  };
  modalCalcPad.appendChild(b);
});


function updateModalChange(){
  let total = cart.reduce((sum,i)=>sum+i.price*i.qty,0);
  let paid = parseInt(document.getElementById("modalAmountInput").value||0,10);
  document.getElementById("modalChange").textContent = (paid-total)>=0?(paid-total):0;
}

function confirmPayment(){
  let total = cart.reduce((sum,i)=>sum+i.price*i.qty,0);
  let paid = parseInt(document.getElementById("modalAmountInput").value||0,10);

  if(isNaN(paid) || paid < total) {
    showPopup("é ã‚Šé‡‘ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚");
    return;
  }

  let change = paid - total;

  // 1å›ç›®ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã€ŒãŠã¤ã‚Šã€
  showPopup("ãŠã¤ã‚Š: " + change + "å††","30px");

  // OKãƒœã‚¿ãƒ³ã‚’å·®ã—æ›¿ãˆ
  const popupBtn = document.querySelector("#popupModal .popup-content button");
  popupBtn.onclick = function() {
    closePopup();

    // å£²ä¸Šç™»éŒ²å‡¦ç†
    let now = new Date();
    sales.push({ items: [...cart], total, datetime: now.toLocaleString(), method: paymentMethod });
    localStorage.setItem("sales", JSON.stringify(sales));
    renderSales();
    cart = [];
    renderCart();
    closeModal();

    // 2å›ç›®ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã€Œä¼šè¨ˆç¢ºå®šã—ã¾ã—ãŸã€
    showPopup("ä¼šè¨ˆç¢ºå®šã—ã¾ã—ãŸã€‚");

    // ãƒœã‚¿ãƒ³å‹•ä½œã‚’å…ƒã«æˆ»ã™
    popupBtn.onclick = closePopup;

    // â˜…ä¼šè¨ˆç¢ºå®šå¾Œã¯æ”¯æ‰•æ–¹æ³•ã‚’ç¾é‡‘ã«æˆ»ã™
    setPayment("ç¾é‡‘");

  };
}

function renderSales() {
  const list = document.getElementById("salesList");
  list.innerHTML = "";
  let sum = 0;
  let productSummary = {};
  let paymentSummary = {};
  sales.forEach((s, idx) => {
    let li = document.createElement("li");
    li.textContent = `No.${idx+1} åˆè¨ˆ ${s.total}å†† (${s.items.reduce((q,i)=>q+i.qty,0)}ç‚¹) [${s.datetime}] [${s.method}]`;
    list.appendChild(li);
    sum += s.total;
    s.items.forEach(i=>{
      if(!productSummary[i.name]) productSummary[i.name] = 0;
      productSummary[i.name] += i.qty;   // â† é‡‘é¡ã§ã¯ãªãæ•°é‡
    });
    if(!paymentSummary[s.method]) paymentSummary[s.method]=0;
    paymentSummary[s.method]+=s.total;
  });
  document.getElementById("salesTotal").textContent = sum;
  const ps = document.getElementById("productSummary"); 
  ps.innerHTML="";
  for(let k in productSummary){
    let li=document.createElement("li");
    li.textContent=`${k}: ${productSummary[k]}ç‚¹`;  // â† å†† â†’ ç‚¹
    ps.appendChild(li);
  }
  const pm = document.getElementById("paymentSummary"); pm.innerHTML="";
  for(let k in paymentSummary){ let li=document.createElement("li"); li.textContent=`${k}: ${paymentSummary[k]}å††`; pm.appendChild(li);}
}

function renderProductMaster() {
  const list = document.getElementById("productMasterList");
  list.innerHTML = "";
  products.forEach((p, idx) => {
    let li = document.createElement("li");
    li.className = "product-item";

    // å•†å“å
    let nameSpan = document.createElement("span");
    nameSpan.textContent = `${p.name} (${p.price}å††)`;

    // ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
    let btnBox = document.createElement("div");
    btnBox.className = "btn-box";

    // ç·¨é›†ãƒœã‚¿ãƒ³ï¼ˆâœï¸ï¼‰
    let editBtn = document.createElement("button");
    editBtn.textContent = "âœï¸";
    editBtn.title = "ç·¨é›†";
    editBtn.onclick = () => {
      let newName = prompt("å•†å“åã‚’å…¥åŠ›:", p.name);
      if(newName) p.name = newName;
      let newPrice = prompt("å˜ä¾¡ã‚’å…¥åŠ›:", p.price);
      if(newPrice && !isNaN(newPrice)) p.price = parseInt(newPrice,10);
      saveProducts();
      renderProductMaster();
      renderMenu();
    };

    // å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆğŸ—‘ï¸ï¼‰
    let delBtn = document.createElement("button");
    delBtn.textContent = "ğŸ—‘ï¸";
    delBtn.title = "å‰Šé™¤";
    delBtn.onclick = () => {
      if(confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
        products.splice(idx,1);
        saveProducts();
        renderProductMaster();
        renderMenu();
      }
    };

    btnBox.appendChild(editBtn);
    btnBox.appendChild(delBtn);

    li.appendChild(nameSpan);
    li.appendChild(btnBox);
    list.appendChild(li);
  });
}

function addProduct(){
  const name = document.getElementById("newProductName").value.trim();
  const price = parseInt(document.getElementById("newProductPrice").value,10);
  if(!name || isNaN(price)) return showPopup("å•†å“åã¨å˜ä¾¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
  products.push({ name, price });
  saveProducts();
  renderProductMaster();
  renderMenu();
  document.getElementById("newProductName").value="";
  document.getElementById("newProductPrice").value="";
}

// --- ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†æç”» ---
function renderMenu(){
  const menuDiv = document.getElementById("menu");
  menuDiv.innerHTML = "";
  products.forEach((p) => {
    let btn = document.createElement("button");
    btn.textContent = `${p.name}\n${p.price}å††`;
    btn.onclick = () => addToCart(p);
    menuDiv.appendChild(btn);
  });
}

// --- æ°¸ç¶šåŒ– ---
function saveProducts(){
  localStorage.setItem("products", JSON.stringify(products));
}

// åˆæœŸãƒ­ãƒ¼ãƒ‰
if(localStorage.getItem("products")){
  products.splice(0, products.length, ...JSON.parse(localStorage.getItem("products")));
}
renderProductMaster();
renderMenu();


function printKitchen() {
  if (cart.length === 0) return showPopup("ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™ã€‚");

  const now = new Date().toLocaleString();
  const orderNo = sales.length + 1;

  let html = `
    <html>
    <head>
      <style>
        @media print {
          @page { size: 58mm auto; margin: 0; }
          body { width: 58mm; font-size: 10pt; line-height: 1.2; margin: 0; }
          hr { border: none; border-top: 1px solid #000; margin: 2px 0; }
        }
      </style>
    </head>
    <body>
      <div style="text-align:center; font-weight:bold; font-size:12pt;">ã‚­ãƒƒãƒãƒ³ä¼ç¥¨</div>
      <hr>
      <div>æ—¥æ™‚: ${now}</div>
      <div>No.${orderNo}</div>
      <hr>
  `;

  cart.forEach(item => {
    html += `${item.name} x${item.qty}<br>`;
  });

  html += `
      <hr>
      <div style="text-align:right;">åˆè¨ˆ: ${cart.reduce((s,i)=>s+i.price*i.qty,0)}å††</div>
    </body>
    </html>
  `;

  let printWin = window.open("", "_blank");
  printWin.document.write(html);
  printWin.document.close();
  printWin.focus();
  printWin.print();
  printWin.close();
}



function exportCSV() {
  if(sales.length===0) return showPopup("å£²ä¸Šãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
  let csv = "No,æ—¥æ™‚,å•†å“,æ•°é‡,å˜ä¾¡,å°è¨ˆ,æ±ºæ¸ˆæ–¹æ³•\n";
  sales.forEach((s, idx) => {
    s.items.forEach(i => { csv += `${idx+1},${s.datetime},${i.name},${i.qty},${i.price},${i.price*i.qty},${s.method}\n`; });
    csv += `${idx+1},${s.datetime},åˆè¨ˆ,, ,${s.total},${s.method}\n`;
  });
  let bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
  let blob = new Blob([bom, csv], {type:"text/csv"});
  let url = URL.createObjectURL(blob);
  let a = document.createElement("a");
  a.href = url;
  a.download = "sales.csv";
  a.click();
  URL.revokeObjectURL(url);
}

function resetSales(){
  if(confirm("å£²ä¸Šå±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")){
    sales=[]; localStorage.removeItem("sales");
    renderSales();
  }
}

function showPopup(message, fontSize = "20px") {
  const modal = document.getElementById("popupModal");
  const msgEl = document.getElementById("popupMessage");
  msgEl.textContent = message;
  msgEl.style.fontSize = fontSize; // ã“ã“ã§ã‚µã‚¤ã‚ºå¤‰æ›´
  modal.style.display = "flex";
}


function closePopup() {
  document.getElementById("popupModal").style.display = "none";
}

function toggleSection(id, btn) {
  const el = document.getElementById(id);
  if (!el) return;

  if (el.style.display === "none") {
    el.style.display = "block";
    btn.textContent = "â–¼";  // é–‹ã„ãŸã‚‰ä¸‹å‘ã
  } else {
    el.style.display = "none";
    btn.textContent = "â–²";  // é–‰ã˜ãŸã‚‰ä¸Šå‘ã
  }
}


</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./service-worker.js")
    .then(reg => console.log("Service Worker registered:", reg))
    .catch(err => console.error("Service Worker failed:", err));
}
</script>

</body>
</html>
